services:
  - type: web
    name: blog-app
    env: python
    plan: free
    region: oregon

    buildCommand: >
      pip install --upgrade pip &&
      pip install -r requirements.txt &&
      python manage.py collectstatic --noinput &&
      python manage.py migrate

    startCommand: >
      gunicorn blog_app.wsgi:application --bind 0.0.0.0:$PORT

    envVars:
      # Secret key
      - key: SECRET_KEY
        generateValue: true

      # Debug OFF for production
      - key: DEBUG
        value: "False"

      # Allowed hosts
      - key: ALLOWED_HOSTS
        value: "blog-app.onrender.com,localhost,127.0.0.1"

      # Internal Database URL from Render
      - key: INTERNAL_DB_URL
        fromDatabase:
          name: blog-db
          property: connectionString

      # Cloudinary: Inject automatically
      - key: CLOUDINARY_URL
        fromService:
          name: cloudinary
          type: external

      # Static location for whitenoise
      - key: STATIC_URL
        value: "/static/"

      - key: STATIC_ROOT
        value: "staticfiles"

databases:
  - name: blog-db
    region: oregon
    plan: free
    databaseName: blog
    user: blog_user

externalServices:
  - name: cloudinary
    type: cloudinary
